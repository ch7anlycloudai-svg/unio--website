<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø· - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
    <style>
        /* Media Management Styles */
        .media-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .media-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .media-tab:hover {
            background: #f3f4f6;
        }

        .media-tab.active {
            background: #006233;
            color: white;
        }

        .media-section {
            display: none;
        }

        .media-section.active {
            display: block;
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .media-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .media-card__image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #f3f4f6;
        }

        .media-card__placeholder {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #006233, #004d28);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .media-card__body {
            padding: 1rem;
        }

        .media-card__title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
        }

        .media-card__subtitle {
            color: #6b7280;
            font-size: 0.9rem;
            margin: 0 0 1rem 0;
        }

        .media-card__actions {
            display: flex;
            gap: 0.5rem;
        }

        .media-card__status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .media-card__status--active {
            background: #d1fae5;
            color: #065f46;
        }

        .media-card__status--inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #f9fafb;
            margin-bottom: 1rem;
        }

        .upload-area:hover {
            border-color: #006233;
            background: #f0fdf4;
        }

        .upload-area.dragover {
            border-color: #006233;
            background: #d1fae5;
        }

        .upload-area__icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .upload-area__text {
            color: #6b7280;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        .upload-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin-top: 1rem;
        }

        /* Modal Form */
        .modal-form .form-group {
            margin-bottom: 1rem;
        }

        .modal-form label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .modal-form input,
        .modal-form textarea,
        .modal-form select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
        }

        .modal-form input:focus,
        .modal-form textarea:focus,
        .modal-form select:focus {
            outline: none;
            border-color: #006233;
            box-shadow: 0 0 0 3px rgba(0, 98, 51, 0.1);
        }

        .modal-form textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .items-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .items-list__item {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            background: #f3f4f6;
            border-radius: 20px;
            font-size: 0.875rem;
        }

        .items-list__remove {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            padding: 0;
            font-size: 1rem;
        }

        .add-item-group {
            display: flex;
            gap: 0.5rem;
        }

        .add-item-group input {
            flex: 1;
        }

        /* Video URL Input */
        .video-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .video-input-group .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        .video-preview {
            margin-top: 1rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
        }

        .video-preview__badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: #fee2e2;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .video-preview__badge--youtube { background: #fee2e2; color: #dc2626; }
        .video-preview__badge--vimeo { background: #dbeafe; color: #2563eb; }
        .video-preview__badge--drive { background: #fef3c7; color: #d97706; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
        }

        .empty-state__icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal.open {
            display: flex;
        }

        .modal__content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal__header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal__title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .modal__close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280;
        }

        .modal__body {
            padding: 1.5rem;
        }

        .modal__footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .media-tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <p>Ø§ØªØ­Ø§Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø©</p>
        </div>

        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </a>
            <a href="news.html" class="nav-item">
                <span class="nav-icon">ğŸ“°</span>
                <span>Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</span>
            </a>
            <a href="messages.html" class="nav-item">
                <span class="nav-icon">âœ‰ï¸</span>
                <span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
            </a>
            <a href="pages.html" class="nav-item">
                <span class="nav-icon">ğŸ“„</span>
                <span>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª</span>
            </a>
            <a href="media.html" class="nav-item active">
                <span class="nav-icon">ğŸ–¼ï¸</span>
                <span>Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <a href="/" class="nav-item">
                <span class="nav-icon">ğŸŒ</span>
                <span>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</span>
            </a>
            <button onclick="logout()" class="nav-item logout-btn">
                <span class="nav-icon">ğŸšª</span>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="content-header">
            <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© ØµÙˆØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØµÙˆØ± Ø§Ù„ØªØ®ØµØµØ§Øª ÙˆØ§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</p>
        </header>

        <!-- Tabs -->
        <div class="media-tabs">
            <button class="media-tab active" data-tab="hero">ğŸ–¼ï¸ ØµÙˆØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="media-tab" data-tab="specialties">ğŸ“š Ø§Ù„ØªØ®ØµØµØ§Øª</button>
        </div>

        <!-- Hero Slides Section -->
        <div class="media-section active" id="heroSection">
            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">ØµÙˆØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
                <button class="btn btn-primary" onclick="openHeroModal()">â• Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            </div>

            <div class="media-grid" id="heroGrid">
                <div class="empty-state" id="heroEmpty">
                    <div class="empty-state__icon">ğŸ–¼ï¸</div>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±Ø§Ø¦Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                    <button class="btn btn-primary" onclick="openHeroModal()">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø©</button>
                </div>
            </div>
        </div>

        <!-- Specialties Section -->
        <div class="media-section" id="specialtiesSection">
            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin: 0;">Ø§Ù„ØªØ®ØµØµØ§Øª</h2>
                <button class="btn btn-primary" onclick="openSpecialtyModal()">â• Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯</button>
            </div>

            <div class="media-grid" id="specialtiesGrid">
                <div class="empty-state" id="specialtiesEmpty">
                    <div class="empty-state__icon">ğŸ“š</div>
                    <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Hero Slide Modal -->
    <div class="modal" id="heroModal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 class="modal__title" id="heroModalTitle">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="modal__close" onclick="closeHeroModal()">âœ•</button>
            </div>
            <div class="modal__body">
                <form id="heroForm" class="modal-form">
                    <input type="hidden" id="heroId">

                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„Ø´Ø±ÙŠØ­Ø© *</label>
                        <div class="upload-area" id="heroUploadArea">
                            <div class="upload-area__icon">ğŸ“·</div>
                            <p class="upload-area__text">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                            <input type="file" id="heroImageInput" accept="image/*">
                            <img id="heroImagePreview" class="upload-preview" style="display: none;">
                        </div>
                        <input type="hidden" id="heroImageUrl" required>
                        <small style="color: #6b7280;">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©:</small>
                        <input type="url" id="heroImageUrlInput" placeholder="https://example.com/image.jpg" style="margin-top: 0.5rem;">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" id="heroTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙŠØ­Ø©">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ±ØªÙŠØ¨</label>
                            <input type="number" id="heroOrder" value="0" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ</label>
                        <textarea id="heroSubtitle" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ± Ù„Ù„Ø´Ø±ÙŠØ­Ø©"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø±Ø§Ø¨Ø· Ø§Ù„Ø²Ø±</label>
                            <input type="url" id="heroLinkUrl" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label>Ù†Øµ Ø§Ù„Ø²Ø±</label>
                            <input type="text" id="heroLinkText" placeholder="Ø§Ù„Ù…Ø²ÙŠØ¯">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="heroActive" checked>
                            Ù…ÙØ¹Ù‘Ù„
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn-secondary" onclick="closeHeroModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveHeroSlide()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Specialty Modal -->
    <div class="modal" id="specialtyModal">
        <div class="modal__content">
            <div class="modal__header">
                <h3 class="modal__title" id="specialtyModalTitle">Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯</h3>
                <button class="modal__close" onclick="closeSpecialtyModal()">âœ•</button>
            </div>
            <div class="modal__body">
                <form id="specialtyForm" class="modal-form">
                    <input type="hidden" id="specialtyId">

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©) *</label>
                            <input type="text" id="specialtyNameAr" required placeholder="Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ©">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù…Ø¹Ø±Ù (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) *</label>
                            <input type="text" id="specialtyName" required placeholder="medical">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ)</label>
                            <input type="text" id="specialtyIcon" placeholder="ğŸ¥">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ±ØªÙŠØ¨</label>
                            <input type="number" id="specialtyOrder" value="0" min="0">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„ÙˆØµÙ</label>
                        <textarea id="specialtyDescription" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„ØªØ®ØµØµ"></textarea>
                    </div>

                    <div class="form-group">
                        <label>Ù…Ø¯Ø© Ø§Ù„Ø¯Ø±Ø§Ø³Ø©</label>
                        <input type="text" id="specialtyDuration" placeholder="5 Ø³Ù†ÙˆØ§Øª">
                    </div>

                    <div class="form-group">
                        <label>ØµÙˆØ±Ø© Ø§Ù„ØªØ®ØµØµ</label>
                        <div class="upload-area" id="specialtyUploadArea">
                            <div class="upload-area__icon">ğŸ“·</div>
                            <p class="upload-area__text">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                            <input type="file" id="specialtyImageInput" accept="image/*">
                            <img id="specialtyImagePreview" class="upload-preview" style="display: none;">
                        </div>
                        <input type="hidden" id="specialtyImageUrl">
                        <small style="color: #6b7280;">Ø£Ùˆ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©:</small>
                        <input type="url" id="specialtyImageUrlInput" placeholder="https://example.com/image.jpg" style="margin-top: 0.5rem;">
                    </div>

                    <div class="form-group">
                        <label>Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ</label>
                        <div class="video-input-group">
                            <div class="form-group">
                                <input type="url" id="specialtyVideoUrl" placeholder="YouTube, Vimeo, Ø£Ùˆ Google Drive">
                            </div>
                            <button type="button" class="btn btn-secondary" onclick="parseVideoUrl()">ØªØ­Ù‚Ù‚</button>
                        </div>
                        <div id="videoPreview" class="video-preview" style="display: none;"></div>
                        <input type="hidden" id="specialtyVideoType" value="youtube">
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„ØªØ®ØµØµØ§Øª Ø§Ù„ÙØ±Ø¹ÙŠØ©</label>
                        <div class="items-list" id="specialtyItemsList"></div>
                        <div class="add-item-group">
                            <input type="text" id="newItemInput" placeholder="Ø£Ø¶Ù ØªØ®ØµØµ ÙØ±Ø¹ÙŠ">
                            <button type="button" class="btn btn-secondary" onclick="addItem()">Ø¥Ø¶Ø§ÙØ©</button>
                        </div>
                        <input type="hidden" id="specialtyItems">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="specialtyActive" checked>
                            Ù…ÙØ¹Ù‘Ù„
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn-secondary" onclick="closeSpecialtyModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" onclick="saveSpecialty()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script>
        // Require authentication
        requireAuth();

        let heroSlides = [];
        let specialties = [];
        let currentItems = [];

        // ========================================
        // Tab Navigation
        // ========================================
        document.querySelectorAll('.media-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.media-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.media-section').forEach(s => s.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}Section`).classList.add('active');
            });
        });

        // ========================================
        // Load Data
        // ========================================
        async function loadHeroSlides() {
            try {
                const data = await apiGet('/api/media/hero/all');
                if (data.success) {
                    heroSlides = data.data;
                    renderHeroSlides();
                }
            } catch (error) {
                console.error('Error loading hero slides:', error);
            }
        }

        async function loadSpecialties() {
            try {
                const data = await apiGet('/api/media/specialties/all');
                if (data.success) {
                    specialties = data.data;
                    renderSpecialties();
                }
            } catch (error) {
                console.error('Error loading specialties:', error);
            }
        }

        // ========================================
        // Render Functions
        // ========================================
        function renderHeroSlides() {
            const grid = document.getElementById('heroGrid');
            const empty = document.getElementById('heroEmpty');

            if (heroSlides.length === 0) {
                grid.innerHTML = '';
                grid.appendChild(empty);
                empty.style.display = 'block';
                return;
            }

            empty.style.display = 'none';
            grid.innerHTML = heroSlides.map(slide => `
                <div class="media-card">
                    ${slide.image_url
                        ? `<img src="${escapeHtml(slide.image_url)}" class="media-card__image" alt="">`
                        : '<div class="media-card__placeholder">ğŸ–¼ï¸</div>'
                    }
                    <div class="media-card__body">
                        <span class="media-card__status ${slide.is_active ? 'media-card__status--active' : 'media-card__status--inactive'}">
                            ${slide.is_active ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}
                        </span>
                        <h4 class="media-card__title">${escapeHtml(slide.title) || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h4>
                        <p class="media-card__subtitle">${escapeHtml(slide.subtitle) || ''}</p>
                        <div class="media-card__actions">
                            <button class="btn btn-sm btn-secondary" onclick="editHeroSlide(${slide.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteHeroSlide(${slide.id})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderSpecialties() {
            const grid = document.getElementById('specialtiesGrid');
            const empty = document.getElementById('specialtiesEmpty');

            if (specialties.length === 0) {
                grid.innerHTML = '';
                grid.appendChild(empty);
                empty.innerHTML = '<div class="empty-state__icon">ğŸ“š</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ®ØµØµØ§Øª</p>';
                return;
            }

            empty.style.display = 'none';
            grid.innerHTML = specialties.map(spec => `
                <div class="media-card">
                    ${spec.image_url
                        ? `<img src="${escapeHtml(spec.image_url)}" class="media-card__image" alt="">`
                        : `<div class="media-card__placeholder">${escapeHtml(spec.icon || 'ğŸ“š')}</div>`
                    }
                    <div class="media-card__body">
                        <span class="media-card__status ${spec.is_active ? 'media-card__status--active' : 'media-card__status--inactive'}">
                            ${spec.is_active ? 'Ù…ÙØ¹Ù‘Ù„' : 'Ù…Ø¹Ø·Ù‘Ù„'}
                        </span>
                        <h4 class="media-card__title">${escapeHtml(spec.icon || '')} ${escapeHtml(spec.name_ar)}</h4>
                        <p class="media-card__subtitle">${escapeHtml(spec.description) || ''}</p>
                        ${spec.video_url ? '<span style="color: #006233; font-size: 0.875rem;">ğŸ“¹ ÙŠØ­ØªÙˆÙŠ ÙÙŠØ¯ÙŠÙˆ</span>' : ''}
                        <div class="media-card__actions" style="margin-top: 0.5rem;">
                            <button class="btn btn-sm btn-secondary" onclick="editSpecialty(${spec.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteSpecialty(${spec.id})">Ø­Ø°Ù</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ========================================
        // Hero Slide Modal
        // ========================================
        function openHeroModal(id = null) {
            document.getElementById('heroModalTitle').textContent = id ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ­Ø©' : 'Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙŠØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©';
            document.getElementById('heroForm').reset();
            document.getElementById('heroId').value = '';
            document.getElementById('heroImageUrl').value = '';
            document.getElementById('heroImagePreview').style.display = 'none';

            if (id) {
                const slide = heroSlides.find(s => s.id === id);
                if (slide) {
                    document.getElementById('heroId').value = slide.id;
                    document.getElementById('heroTitle').value = slide.title || '';
                    document.getElementById('heroSubtitle').value = slide.subtitle || '';
                    document.getElementById('heroImageUrl').value = slide.image_url || '';
                    document.getElementById('heroImageUrlInput').value = slide.image_url || '';
                    document.getElementById('heroLinkUrl').value = slide.link_url || '';
                    document.getElementById('heroLinkText').value = slide.link_text || '';
                    document.getElementById('heroOrder').value = slide.display_order || 0;
                    document.getElementById('heroActive').checked = slide.is_active;

                    if (slide.image_url) {
                        document.getElementById('heroImagePreview').src = slide.image_url;
                        document.getElementById('heroImagePreview').style.display = 'block';
                    }
                }
            }

            document.getElementById('heroModal').classList.add('open');
        }

        function closeHeroModal() {
            document.getElementById('heroModal').classList.remove('open');
        }

        function editHeroSlide(id) {
            openHeroModal(id);
        }

        async function saveHeroSlide() {
            const id = document.getElementById('heroId').value;
            const imageUrl = document.getElementById('heroImageUrl').value || document.getElementById('heroImageUrlInput').value;

            if (!imageUrl) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©', 'error');
                return;
            }

            const data = {
                title: document.getElementById('heroTitle').value,
                subtitle: document.getElementById('heroSubtitle').value,
                image_url: imageUrl,
                link_url: document.getElementById('heroLinkUrl').value,
                link_text: document.getElementById('heroLinkText').value,
                display_order: parseInt(document.getElementById('heroOrder').value) || 0,
                is_active: document.getElementById('heroActive').checked
            };

            try {
                if (id) {
                    await apiPut(`/api/media/hero/${id}`, data);
                    showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    await apiPost('/api/media/hero', data);
                    showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                closeHeroModal();
                loadHeroSlides();
            } catch (error) {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error');
            }
        }

        async function deleteHeroSlide(id) {
            if (!confirmAction('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙŠØ­Ø©ØŸ')) return;

            try {
                await apiDelete(`/api/media/hero/${id}`);
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø´Ø±ÙŠØ­Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadHeroSlides();
            } catch (error) {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error');
            }
        }

        // ========================================
        // Specialty Modal
        // ========================================
        function openSpecialtyModal(id = null) {
            document.getElementById('specialtyModalTitle').textContent = id ? 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ®ØµØµ' : 'Ø¥Ø¶Ø§ÙØ© ØªØ®ØµØµ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('specialtyForm').reset();
            document.getElementById('specialtyId').value = '';
            document.getElementById('specialtyImageUrl').value = '';
            document.getElementById('specialtyImagePreview').style.display = 'none';
            document.getElementById('videoPreview').style.display = 'none';
            currentItems = [];
            renderItems();

            if (id) {
                const spec = specialties.find(s => s.id === id);
                if (spec) {
                    document.getElementById('specialtyId').value = spec.id;
                    document.getElementById('specialtyNameAr').value = spec.name_ar || '';
                    document.getElementById('specialtyName').value = spec.name || '';
                    document.getElementById('specialtyIcon').value = spec.icon || '';
                    document.getElementById('specialtyDescription').value = spec.description || '';
                    document.getElementById('specialtyDuration').value = spec.duration || '';
                    document.getElementById('specialtyImageUrl').value = spec.image_url || '';
                    document.getElementById('specialtyImageUrlInput').value = spec.image_url || '';
                    document.getElementById('specialtyVideoUrl').value = spec.video_url || '';
                    document.getElementById('specialtyVideoType').value = spec.video_type || 'youtube';
                    document.getElementById('specialtyOrder').value = spec.display_order || 0;
                    document.getElementById('specialtyActive').checked = spec.is_active;

                    if (spec.image_url) {
                        document.getElementById('specialtyImagePreview').src = spec.image_url;
                        document.getElementById('specialtyImagePreview').style.display = 'block';
                    }

                    currentItems = Array.isArray(spec.items) ? spec.items : [];
                    renderItems();

                    if (spec.video_url) {
                        parseVideoUrl();
                    }
                }
            }

            document.getElementById('specialtyModal').classList.add('open');
        }

        function closeSpecialtyModal() {
            document.getElementById('specialtyModal').classList.remove('open');
        }

        function editSpecialty(id) {
            openSpecialtyModal(id);
        }

        async function saveSpecialty() {
            const id = document.getElementById('specialtyId').value;
            const nameAr = document.getElementById('specialtyNameAr').value;
            const name = document.getElementById('specialtyName').value;

            if (!nameAr || !name) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ', 'error');
                return;
            }

            const imageUrl = document.getElementById('specialtyImageUrl').value || document.getElementById('specialtyImageUrlInput').value;

            const data = {
                name: name,
                name_ar: nameAr,
                icon: document.getElementById('specialtyIcon').value,
                description: document.getElementById('specialtyDescription').value,
                duration: document.getElementById('specialtyDuration').value,
                image_url: imageUrl,
                video_url: document.getElementById('specialtyVideoUrl').value,
                video_type: document.getElementById('specialtyVideoType').value,
                items: currentItems,
                display_order: parseInt(document.getElementById('specialtyOrder').value) || 0,
                is_active: document.getElementById('specialtyActive').checked
            };

            try {
                if (id) {
                    await apiPut(`/api/media/specialties/${id}`, data);
                    showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    await apiPost('/api/media/specialties', data);
                    showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                closeSpecialtyModal();
                loadSpecialties();
            } catch (error) {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸', 'error');
            }
        }

        async function deleteSpecialty(id) {
            if (!confirmAction('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµØŸ')) return;

            try {
                await apiDelete(`/api/media/specialties/${id}`);
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ®ØµØµ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadSpecialties();
            } catch (error) {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error');
            }
        }

        // ========================================
        // Items Management
        // ========================================
        function renderItems() {
            const list = document.getElementById('specialtyItemsList');
            list.innerHTML = currentItems.map((item, index) => `
                <span class="items-list__item">
                    ${escapeHtml(item)}
                    <button class="items-list__remove" onclick="removeItem(${index})">âœ•</button>
                </span>
            `).join('');
        }

        function addItem() {
            const input = document.getElementById('newItemInput');
            const value = input.value.trim();
            if (value) {
                currentItems.push(value);
                renderItems();
                input.value = '';
            }
        }

        function removeItem(index) {
            currentItems.splice(index, 1);
            renderItems();
        }

        // Enter key to add item
        document.getElementById('newItemInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addItem();
            }
        });

        // ========================================
        // Video URL Parser
        // ========================================
        async function parseVideoUrl() {
            const url = document.getElementById('specialtyVideoUrl').value;
            const preview = document.getElementById('videoPreview');

            if (!url) {
                preview.style.display = 'none';
                return;
            }

            try {
                const response = await fetch('/api/media/parse-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('specialtyVideoType').value = data.data.type;

                    const typeLabels = {
                        youtube: 'YouTube',
                        vimeo: 'Vimeo',
                        drive: 'Google Drive'
                    };

                    preview.innerHTML = `
                        <span class="video-preview__badge video-preview__badge--${data.data.type}">${typeLabels[data.data.type]}</span>
                        <p>âœ“ Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­</p>
                    `;
                    preview.style.display = 'block';
                } else {
                    preview.innerHTML = '<p style="color: #ef4444;">âš ï¸ Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…</p>';
                    preview.style.display = 'block';
                }
            } catch (error) {
                preview.innerHTML = '<p style="color: #ef4444;">âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚</p>';
                preview.style.display = 'block';
            }
        }

        // ========================================
        // File Upload
        // ========================================
        function setupUpload(uploadAreaId, inputId, previewId, hiddenInputId, type) {
            const area = document.getElementById(uploadAreaId);
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const hiddenInput = document.getElementById(hiddenInputId);

            if (!area || !input) return;

            area.addEventListener('click', () => input.click());

            area.addEventListener('dragover', (e) => {
                e.preventDefault();
                area.classList.add('dragover');
            });

            area.addEventListener('dragleave', () => {
                area.classList.remove('dragover');
            });

            area.addEventListener('drop', (e) => {
                e.preventDefault();
                area.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    uploadFile(file, preview, hiddenInput, type);
                }
            });

            input.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    uploadFile(file, preview, hiddenInput, type);
                }
            });
        }

        async function uploadFile(file, preview, hiddenInput, type) {
            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch(`/api/media/upload/${type}`, {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    preview.src = data.data.url;
                    preview.style.display = 'block';
                    hiddenInput.value = data.data.url;
                    showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                } else {
                    showToast(data.message || 'Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©', 'error');
                }
            } catch (error) {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©', 'error');
            }
        }

        // Setup upload areas
        setupUpload('heroUploadArea', 'heroImageInput', 'heroImagePreview', 'heroImageUrl', 'hero');
        setupUpload('specialtyUploadArea', 'specialtyImageInput', 'specialtyImagePreview', 'specialtyImageUrl', 'specialties');

        // ========================================
        // Manual URL Input
        // ========================================
        document.getElementById('heroImageUrlInput').addEventListener('input', (e) => {
            const url = e.target.value;
            const preview = document.getElementById('heroImagePreview');
            if (url) {
                preview.src = url;
                preview.style.display = 'block';
                document.getElementById('heroImageUrl').value = url;
            } else {
                preview.style.display = 'none';
            }
        });

        document.getElementById('specialtyImageUrlInput').addEventListener('input', (e) => {
            const url = e.target.value;
            const preview = document.getElementById('specialtyImagePreview');
            if (url) {
                preview.src = url;
                preview.style.display = 'block';
                document.getElementById('specialtyImageUrl').value = url;
            } else {
                preview.style.display = 'none';
            }
        });

        // ========================================
        // Initialize
        // ========================================
        loadHeroSlides();
        loadSpecialties();
    </script>
</body>
</html>
